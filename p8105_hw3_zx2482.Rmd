---
title: "p8105_hw3_zx2482"
author: "Allison Xia"
date: "2023-10-11"
output: github_document
---

```{r setup, include=FALSE}
library(tidyverse)
library(ggridges)
library(patchwork)
library(ggplot2)

library(p8105.datasets)

knitr::opts_chunk$set(
	echo = TRUE,
	warning = FALSE,
	fig.width = 8, 
  fig.height = 6,
  out.width = "90%"
)
```

## Problem 2
```{r Load data}
data("brfss_smart2010") 

brfss_smart2010 = 
  brfss_smart2010 |> 
  as_tibble()
```

```{r clean brfss_smart2010}
brfss_overall_health =
  brfss_smart2010 |> 
  rename(state = Locationabbr,
         location = Locationdesc) |> 
  janitor::clean_names() |> 
  filter(topic == "Overall Health") |> 
  filter(response  %in% c("Excellent","Very good","Good","Fair","Poor")) |> 
  arrange(desc(response)) |> 
  mutate(response = ordered(response, levels = c("Poor", "Fair", "Good","Very good","Excellent"))) |> 
  arrange(response) 
```

#### Answer questions about the data

* In 2002, which states were observed at 7 or more locations? What about in 2010?
```{r}
states_2002 <- 
  brfss_overall_health |> 
  filter(year == "2002") |> 
  group_by(state) |> 
    summarize(number_locations = n()) |> 
  filter(number_locations >= 7) |> 
  pull(state)
states_2010 <- 
  brfss_overall_health |> 
  filter(year == "2010") |> 
  group_by(state) |> 
    summarize(number_locations = n()) |> 
  filter(number_locations >= 7) |> 
  pull(state)
```
In 2002, these following states were observed at 7 or more locations: `r states_2002`. In 2010, these following states were observed at 7 or more locations: `r states_2010`

* Construct a dataset that is limited to Excellent responses, and contains, year, state, and a variable that averages the data_value across locations within a state. Make a “spaghetti” plot of this average value over time within a state (that is, make a plot showing a line for each state across years – the geom_line geometry and group aesthetic will help).
```{r Create brfss_excellent}
brfss_excellent = 
  brfss_overall_health |> 
  filter(response == "Excellent") |> 
  group_by(state, year) |> 
  summarize (mean_data_value = mean(data_value, na.rm=TRUE))
```

```{r Plot brfss_excellent}
ggplot(brfss_excellent, aes(x=year, y=mean_data_value, color=state)) +
  geom_line() +
  labs(title="Spaghetti Plot",
       x="Year",
       y="Mean Data Value") +
  theme_minimal()
```

* Make a two-panel plot showing, for the years 2006, and 2010, distribution of data_value for responses (“Poor” to “Excellent”) among locations in NY State.
```{r}
brfss_NY_responses = 
  brfss_overall_health |> 
  filter(state == "NY" & (year =="2006" | year == "2010"))
```

